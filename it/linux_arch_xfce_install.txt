1. loadkeys uk # /usr/share/kbd/keymaps/

2. ping -c3 www.google.com

3. Partitioning of a 500GB hard drive {{{1

fdisk/gdisk /dev/sda

(d)elete all partitions

* boot: /dev/sda1: (n)ew, (p)rimary, +512M, (t)ype ef00, (a) bootable
* swap: /dev/sda2: (n)ew, (p)rimary, +6G  , (t)ype 8200  # ~ double of RAM
* root: /dev/sda3: (n)ew, (p)rimary, +40G                # includes /usr
*  LVM: /dev/sda4: (n)ew, (p)rimary,        (t)ype 8e00

(p)rint, (w)rite

Note: (p)rimary and (a) are not relevant with gdisk
}}}1

4. reboot # or the new partitions are not seen!

5. Creating Filesystems {{{1

* mkfs.ext2 /dev/sda1
  OR
  mkfs.fat -F32 /dev/sda1

* mkswap /dev/sda2
  swapon /dev/sda2

* mkfs.ext4 /dev/sda3

* pvcreate /dev/sda4
  vgcreate vdisk /dev/sda4
  vol() { lvcreate -L"$1"G vdisk -n"$2" && mkfs.ext4 /dev/vdisk/"$2"; }
  vol 210 home
  vol 11 var
  vol 3 opt

Checks: fdisk -l, lsblk
        pvdisplay, pvscan...

6. Mount the partitions {{{1

mount /dev/sda3 /mnt

for i in boot home var opt
do
   mkdir -p /mnt/"$i"
done

mount /dev/sda1 /mnt/boot

for i in home var opt
do
   mount /dev/vdisk/"$i" /mnt/"$i"
done

7. Mirror list {{{1

vi /etc/pacman.d/mirrorlist
# :g/united\s\+kingdom\n.\+\c/,+m0
# then reverse from 2 to 1
#                   1    2
}}}1

8. pacstrap -i /mnt base # exclude with ^: ^1-5,^8

9. fstab {{{1

genfstab -U -p /mnt >> /mnt/etc/fstab
cat /mnt/etc/fstab # to check
}}}1

10. arch-chroot /mnt

11. Local settings {{{1

# \\1 - \\ needed so $'' doesn't parse it
ed -s /etc/locale.gen <<< $'H\n%s/#\(bg_BG\|fr_FR\|es_ES\|en_GB\|ru_RU\).UTF-8/\\1.UTF-8/\nwq'

locale-gen

echo LANG=en_GB.UTF-8 >> /etc/locale.conf
export LANG=en_GB.UTF-8

loadkeys uk
echo KEYMAP=uk >> /etc/vconsole.conf

ln -s /usr/share/zoneinfo/Europe/London /etc/localtime

hwclock --systohc --utc

12. Networking {{{1

echo myhostname > /etc/hostname

systemctl enable dhcpcd.service # systemctl enable dhcpcd@interface_name.service
# Or: systemctl stop dhcpcd.service && systemctl disable dhcpcd.service
#     systemctl enable dhclient.service && systemctl start dhclient.service

13. GRUB {{{1

pacman -S grub # efibootmgr dosfstools

grub-install /dev/sda
OR
mount -t efivarfs efivarfs /sys/firmware/efi/efivars
efivar -l # test if booted into UEFI mode
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub --recheck # --debug

pacman -S os-prober # for a dual boot setup
grub-mkconfig -o /boot/grub/grub.cfg

14. Finish {{{1

passwd
exit
umount -R /mnt
reboot

15. Post install {{{1

useradd -m mitko
passwd mitko

pacman -S alsa-utils # for alsamixer
pacman -S xorg-server xorg-server-utils xorg-xinit

lspci | grep VGA
pacman -Ss xf86-video | less # to see all
pacman -S xf86-video-XXX

pacman -S xfce4
pacman -S gvfs # for automounting

pacman -S lightdm lightdm-gtk-greeter accountsservice numlockx
systemctl enable lightdm
ln -s /usr/lib/lightdm/lightdm/gdmflexiserver /usr/bin/gdmflexiserver # user switching

# Universal
pacman -S bc ttf-dejavu xscreensaver
pacman -S bash-completion sudo
pacman -S mlocate ntp tree
pacman -S ctags ed gvim
pacman -S clipit xclip wgetpaste
pacman -S firefox flashplugin
pacman -S openssh
# optional
pacman -S cups git vlc

# Distro / Desktop Environment specific
pacman -S --needed base-devel
pacman -S orage ristretto ffmpegthumbnailer
pacman -S xfce4-notifyd

# Work
pacman -S dnsutils rsync
pacman -S cifs-utils clusterssh openldap virtualbox thunderbird tcpdump terminator xterm

# Services
systemctl enable ntpd
